<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#667eea">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="P.I.A.">
  <meta name="description" content="P.I.A. Mobile - Plateforme d'IntermÃ©diation & d'Arbitrage pour le BTP">
  
  <title>P.I.A. Mobile - Choisissez votre profil</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- iOS Icons -->
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="icons/icon-192.png">
  
  <!-- Styles -->
  <link rel="stylesheet" href="/static/mobile.css">
</head>
<body>

  <!-- Landing Container -->
  <div class="landing-container">
    
    <!-- Header -->
    <div class="landing-header">
      <div class="landing-logo">ğŸ—ï¸</div>
      <h1 class="landing-title">P.I.A.</h1>
      <p class="landing-subtitle">Plateforme d'IntermÃ©diation & d'Arbitrage</p>
    </div>

    <!-- Profile Grid -->
    <div class="profile-grid">
      
      <!-- Donneur d'Ordre -->
      <a href="dashboards/do.html" class="profile-card do">
        <div class="profile-icon">ğŸ¢</div>
        <div class="profile-name">Donneur d'Ordre</div>
        <div class="profile-desc">GÃ©rer vos chantiers et sous-traitants</div>
      </a>

      <!-- Artisan -->
      <a href="dashboards/artisan.html" class="profile-card artisan">
        <div class="profile-icon">ğŸ‘·</div>
        <div class="profile-name">Artisan</div>
        <div class="profile-desc">Score P.I.A. et chantiers actifs</div>
      </a>

      <!-- Particulier -->
      <a href="dashboards/b2c.html" class="profile-card b2c">
        <div class="profile-icon">ğŸ </div>
        <div class="profile-name">Particulier</div>
        <div class="profile-desc">Suivre vos travaux en toute sÃ©curitÃ©</div>
      </a>

      <!-- Expert -->
      <a href="dashboards/expert.html" class="profile-card expert">
        <div class="profile-icon">âš–ï¸</div>
        <div class="profile-name">Expert</div>
        <div class="profile-desc">Arbitrer et expertiser les litiges</div>
      </a>

    </div>

    <!-- Footer Info -->
    <div style="text-align: center; color: rgba(255,255,255,0.8); margin-top: 24px; font-size: 14px;">
      <p style="margin: 0;">Version Mobile PWA 1.0</p>
      <p style="margin: 4px 0 0 0; font-size: 12px;">Installez l'app pour un accÃ¨s rapide</p>
    </div>

  </div>

  <!-- PWA Install Prompt (hidden by default) -->
  <div id="install-prompt" style="display: none; position: fixed; bottom: 16px; left: 16px; right: 16px; background: white; border-radius: 12px; padding: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); z-index: 1000;">
    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
      <div style="font-size: 32px;">ğŸ“±</div>
      <div style="flex: 1;">
        <div style="font-weight: 600; margin-bottom: 4px;">Installer P.I.A.</div>
        <div style="font-size: 14px; color: #6B7280;">AccÃ©dez rapidement Ã  vos dashboards</div>
      </div>
    </div>
    <div style="display: flex; gap: 8px;">
      <button id="install-button" class="btn btn-primary" style="flex: 1;">Installer</button>
      <button id="install-dismiss" class="btn btn-outline">Plus tard</button>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // ============================================
    // PWA INSTALL PROMPT
    // ============================================
    
    let deferredPrompt;
    const installPrompt = document.getElementById('install-prompt');
    const installButton = document.getElementById('install-button');
    const dismissButton = document.getElementById('install-dismiss');

    // Capture the install prompt event
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      
      // Show install prompt after 2 seconds
      setTimeout(() => {
        installPrompt.style.display = 'block';
        installPrompt.classList.add('fade-in');
      }, 2000);
    });

    // Install button click
    installButton.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      
      console.log(`User response: ${outcome}`);
      deferredPrompt = null;
      installPrompt.style.display = 'none';
    });

    // Dismiss button click
    dismissButton.addEventListener('click', () => {
      installPrompt.style.display = 'none';
      
      // Don't show again for 7 days
      localStorage.setItem('pia_install_dismissed', Date.now());
    });

    // Check if already dismissed recently
    const dismissed = localStorage.getItem('pia_install_dismissed');
    if (dismissed) {
      const daysSince = (Date.now() - parseInt(dismissed)) / (1000 * 60 * 60 * 24);
      if (daysSince < 7) {
        // Don't show prompt
        window.addEventListener('beforeinstallprompt', (e) => {
          e.preventDefault();
        });
      }
    }

    // ============================================
    // SERVICE WORKER REGISTRATION
    // ============================================
    
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .then(registration => {
            console.log('âœ… Service Worker registered:', registration.scope);
          })
          .catch(error => {
            console.error('âŒ Service Worker registration failed:', error);
          });
      });
    }

    // ============================================
    // HAPTIC FEEDBACK (iOS/Android)
    // ============================================
    
    document.querySelectorAll('.profile-card').forEach(card => {
      // Use touchstart for better iOS responsiveness
      card.addEventListener('touchstart', () => {
        // Vibration API (Android)
        if (navigator.vibrate) {
          navigator.vibrate(10);
        }
      }, { passive: true });
      
      // Ensure links work on Safari
      card.addEventListener('click', (e) => {
        console.log('Profile card clicked:', card.href);
        // Let the default link behavior work
      });
    });

    // ============================================
    // TRACK APP INSTALL
    // ============================================
    
    window.addEventListener('appinstalled', () => {
      console.log('âœ… P.I.A. app installed successfully');
      
      // Track in analytics (if available)
      if (window.gtag) {
        gtag('event', 'app_install', {
          'event_category': 'PWA',
          'event_label': 'P.I.A. Mobile'
        });
      }
    });

    // ============================================
    // NETWORK STATUS
    // ============================================
    
    window.addEventListener('online', () => {
      console.log('âœ… Network: Online');
      // Could show a notification
    });

    window.addEventListener('offline', () => {
      console.log('âš ï¸ Network: Offline');
      // Could show offline indicator
    });

    // ============================================
    // PREVENT ZOOM ON DOUBLE TAP (iOS)
    // ============================================
    
    let lastTouchEnd = 0;
    document.addEventListener('touchend', (event) => {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) {
        // Only prevent if NOT clicking on a link or button
        if (!event.target.closest('a, button')) {
          event.preventDefault();
        }
      }
      lastTouchEnd = now;
    }, false);

  </script>

</body>
</html>
